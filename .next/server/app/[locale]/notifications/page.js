(()=>{var e={};e.id=284,e.ids=[284],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},2081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},612:e=>{"use strict";e.exports=require("node:os")},7742:e=>{"use strict";e.exports=require("node:process")},5997:e=>{"use strict";e.exports=require("node:tty")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5256:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>f,tree:()=>c});var s=r(8149),n=r(2658),i=r(9457),o=r.n(i),a=r(9960),d={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>a[e]);r.d(t,d);let c=["",{children:["[locale]",{children:["notifications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3789)),"C:\\Users\\Admin\\OneDrive\\Desktop\\Project\\eco\\frontend\\src\\app\\[locale]\\notifications\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,4208)),"C:\\Users\\Admin\\OneDrive\\Desktop\\Project\\eco\\frontend\\src\\app\\[locale]\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,6738)),"C:\\Users\\Admin\\OneDrive\\Desktop\\Project\\eco\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7066,23)),"next/dist/client/components/not-found-error"]}],l=["C:\\Users\\Admin\\OneDrive\\Desktop\\Project\\eco\\frontend\\src\\app\\[locale]\\notifications\\page.tsx"],u="/[locale]/notifications/page",p={require:r,loadChunk:()=>Promise.resolve()},f=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/[locale]/notifications/page",pathname:"/[locale]/notifications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5346:(e,t,r)=>{Promise.resolve().then(r.bind(r,5224))},5224:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(241),n=r(1662),i=r(8895),o=r(4045),a=r(2999),d=r(2863);function c({params:{locale:e}}){let t=(0,i.useRouter)(),{ready:r,accessToken:c,role:l}=(0,a._)(),{notifications:u,setNotifications:p,connected:f}=function(e){let[t,r]=(0,n.useState)([]),[s,i]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!e){i(!1);return}let t=(0,d.I)(e),s=()=>i(!0),n=()=>i(!1),o=e=>{r(t=>t.some(t=>t.id===e.notification.id)?t:[e.notification,...t])},a=e=>{r(t=>t.map(t=>t.id===e.notificationId?{...t,readAt:e.readAt}:t))},c=e=>{r(t=>t.map(t=>t.readAt?t:{...t,readAt:e.readAt}))};return t.on("connect",s),t.on("disconnect",n),t.on("notifications:new",o),t.on("notifications:read",a),t.on("notifications:read-all",c),()=>{t.off("connect",s),t.off("disconnect",n),t.off("notifications:new",o),t.off("notifications:read",a),t.off("notifications:read-all",c)}},[e]),{notifications:t,setNotifications:r,connected:s,markRead:(0,n.useCallback)(t=>{e&&(0,d.I)(e).emit("notifications:mark-read",{notificationId:t})},[e]),markAllRead:(0,n.useCallback)(()=>{e&&(0,d.I)(e).emit("notifications:mark-all-read",{})},[e]),disconnect:(0,n.useCallback)(()=>{(0,d.p)()},[])}}(c),[x,m]=(0,n.useState)(!0),[h,b]=(0,n.useState)(!1),[y,g]=(0,n.useState)(null),[j,I]=(0,n.useState)(null);async function v(e){if(c){b(!0);try{let t=await (0,o.R8)(e,c);p(r=>r.map(r=>r.id===e?{...r,readAt:t.readAt??new Date().toISOString()}:r))}catch{g("Failed to mark notification as read.")}finally{b(!1)}}}async function A(r){if(!c)return;if(!r.readAt)try{let e=await (0,o.R8)(r.id,c);p(t=>t.map(t=>t.id===r.id?{...t,readAt:e.readAt??new Date().toISOString()}:t))}catch{g("Failed to mark notification as read.")}let s=function(e,t,r){let s=r.payload&&"object"==typeof r.payload?r.payload:{};return"NEW_MESSAGE"===r.type?s.orderId?`/${e}/chat?orderId=${encodeURIComponent(s.orderId)}`:`/${e}/chat`:"ORDER_STATUS_CHANGED"===r.type?"VENDOR"===t?s.orderId?`/${e}/vendor/orders?orderId=${encodeURIComponent(s.orderId)}`:`/${e}/vendor/orders`:"ADMIN"===t?s.orderId?`/${e}/admin/orders?orderId=${encodeURIComponent(s.orderId)}`:`/${e}/admin/orders`:s.orderId?`/${e}/orders?orderId=${encodeURIComponent(s.orderId)}`:`/${e}/orders`:"RETURN_STATUS_CHANGED"===r.type?"VENDOR"===t?s.returnId?`/${e}/vendor/returns?returnId=${encodeURIComponent(s.returnId)}`:`/${e}/vendor/returns`:"ADMIN"===t?s.returnId?`/${e}/admin/returns?returnId=${encodeURIComponent(s.returnId)}`:`/${e}/admin/returns`:s.orderId?`/${e}/orders?orderId=${encodeURIComponent(s.orderId)}`:`/${e}/orders`:`/${e}`}(e,l,r);t.push(s)}async function N(){if(c){b(!0);try{let e=(await (0,o.op)(c)).readAt??new Date().toISOString();p(t=>t.map(t=>t.readAt?t:{...t,readAt:e}))}catch{g("Failed to mark all notifications as read.")}finally{b(!1)}}}async function q(){if(c&&j&&!h){b(!0);try{let e=await (0,o.wd)({limit:20,cursor:j},c);p(t=>[...t,...e.items??[]]),I(e.nextCursor??null),g(null)}catch{g("Failed to load more notifications.")}finally{b(!1)}}}(0,n.useEffect)(()=>{if(!r)return;if(!c){g("Please login to view notifications."),m(!1);return}let e=!0;return m(!0),(0,o.wd)({limit:20},c).then(t=>{e&&(p(t.items??[]),I(t.nextCursor??null),g(null))}).catch(()=>{e&&g("Failed to load notifications.")}).finally(()=>{e&&m(!1)}),()=>{e=!1}},[r,c,p]);let w=u.filter(e=>!e.readAt).length;return(0,s.jsxs)("section",{className:"space-y-4",children:[s.jsx("div",{className:"surface p-5 md:p-6",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-2xl font-semibold text-[#181f46]",children:"Notifications"}),s.jsx("p",{className:"mt-1 text-sm text-[#5d6486]",children:"Realtime updates for orders, returns, and messages."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`chip ${f?"chip-success":"chip-warn"}`,children:f?"Realtime connected":"Realtime offline"}),(0,s.jsxs)("span",{className:"rounded-full border border-[#d7e2ff] bg-white px-3 py-1 text-xs font-semibold text-[#2f428f]",children:["Unread: ",w]}),s.jsx("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",type:"button",onClick:N,disabled:h||0===w,children:"Mark all read"})]})]})}),y?s.jsx("div",{className:"surface border-[#ffd7dd] bg-[#fff5f6] p-4 text-sm text-[#b12f43]",children:y}):null,x?s.jsx("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"Loading notifications..."}):0===u.length?s.jsx("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"No notifications yet."}):s.jsx("div",{className:"space-y-3",children:u.map(e=>s.jsx("article",{className:`surface p-4 transition ${e.readAt?"bg-white":"border-[#bfd0ff] bg-[#f6f9ff]"}`,role:"button",tabIndex:0,onClick:()=>A(e),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),A(e))},children:(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6371a8]",children:e.type.replaceAll("_"," ")}),s.jsx("h2",{className:"text-base font-semibold text-[#1a224e]",children:e.title}),s.jsx("p",{className:"text-sm text-[#5d6486]",children:e.body}),s.jsx("p",{className:"text-xs text-[#7a84ab]",children:new Date(e.createdAt).toLocaleString()})]}),e.readAt?s.jsx("span",{className:"chip chip-success",children:"Read"}):s.jsx("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",type:"button",disabled:h,onClick:t=>{t.stopPropagation(),v(e.id)},children:"Mark read"})]})},e.id))}),j?s.jsx("div",{className:"flex justify-center",children:s.jsx("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-4 py-2 text-sm font-semibold text-[#3349ad]",type:"button",disabled:h,onClick:q,children:"Load more"})}):null]})}},3789:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});let s=(0,r(3596).createProxy)(String.raw`C:\Users\Admin\OneDrive\Desktop\Project\eco\frontend\src\app\[locale]\notifications\page.tsx`),{__esModule:n,$$typeof:i}=s,o=s.default}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[563,851,482,382],()=>r(5256));module.exports=s})();