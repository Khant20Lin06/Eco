(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[13],{7773:function(e,t,s){Promise.resolve().then(s.bind(s,4870))},4870:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var r=s(5964),l=s(4141),n=s(800),d=s(2207),a=s(3678),i=s(8440),c=s(3808);let o={name:"",line1:"",line2:"",city:"",state:"",postal:"",country:"",phone:""};function u(e,t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"MMK"===t?"MMK":"USD",maximumFractionDigits:"MMK"===t?0:2}).format(e/("USD"===t?100:1))}function f(e){var t,s,f,x,p;let{params:{locale:m}}=e,h=(0,d.useRouter)(),{ready:b,accessToken:v}=(0,i._)(),[y,g]=(0,n.useState)(!0),[N,j]=(0,n.useState)(!1),[P,S]=(0,n.useState)(null),[w,I]=(0,n.useState)(null),[C,k]=(0,n.useState)({items:[]}),[E,A]=(0,n.useState)([]),[M,U]=(0,n.useState)([]),[K,_]=(0,n.useState)(null),[H,q]=(0,n.useState)("SHIPPING"),[D,F]=(0,n.useState)(""),[G,O]=(0,n.useState)(""),[V,L]=(0,n.useState)("WAVE"),[R,W]=(0,n.useState)(o),Z=null!==(f=null!==(s=C.currency)&&void 0!==s?s:null===(t=C.items[0])||void 0===t?void 0:t.variant.currency)&&void 0!==f?f:"USD",B=(0,n.useMemo)(()=>C.items.reduce((e,t)=>e+t.unitPrice*t.qty,0),[C.items]),Y=null!==(x=null==K?void 0:K.flatRate)&&void 0!==x?x:0;function z(){k({items:[]}),_(null),O("")}async function Q(e){if(e.preventDefault(),v){j(!0);try{let e=await (0,a.p6)({name:R.name,line1:R.line1,line2:R.line2||void 0,city:R.city,state:R.state||void 0,postal:R.postal,country:R.country.toUpperCase(),phone:R.phone||void 0},v);A(t=>[e,...t]),F(e.id),W(o),S(null),I("Address added.")}catch(e){S("Failed to create address.")}finally{j(!1)}}}async function T(){if(!v)return;if(0===C.items.length){S("Cart is empty.");return}if("SHIPPING"===H){if(!D){S("Please select shipping address.");return}if(!(null==K?void 0:K.available)){S("Shipping unavailable for selected country.");return}}else if(!G){S("Please select pickup location.");return}j(!0),S(null),I(null);let e=null;try{let t=await (0,a.LV)({fulfillment:H,shippingAddrId:"SHIPPING"===H?D:void 0,pickupLocId:"PICKUP"===H?G:void 0},v);if(e=t.id,"USD"===t.currency){let e=await (0,a.DF)(t.id,v);if(e.url){window.location.href=e.url;return}z(),(0,c.t)(),I("Order created. Stripe checkout session created.")}else"WAVE"===V?await (0,a.vp)(t.id,v):await (0,a.HP)(t.id,v),z(),(0,c.t)(),I("Order paid successfully."),h.push("/".concat(m,"/orders"))}catch(t){e?(z(),(0,c.t)(),S("Order was created (".concat(e,") but payment step failed. Please open Orders and retry payment."))):S(function(e,t){if(!(e instanceof Error))return t;let s=e.message.match(/^API error \d+:\s*(.+)$/);return(null==s?void 0:s[1])?s[1]:e.message||t}(t,"Failed to place order."))}finally{j(!1)}}return(0,n.useEffect)(()=>{if(!b)return;if(!v){S("Please login to checkout."),g(!1);return}let e=!0;return g(!0),Promise.all([(0,a.dv)(v),(0,a.r0)(v)]).then(async t=>{var s,r,l,n,d;let[i,c]=t;if(!e)return;let o={id:i.id,vendorId:i.vendorId,currency:i.currency,items:null!==(r=i.items)&&void 0!==r?r:[]},u=Array.isArray(c)?c:c.items;if(k(o),A(u),F(null!==(l=null===(s=u[0])||void 0===s?void 0:s.id)&&void 0!==l?l:""),o.vendorId){let t=await (0,a.Zc)({vendorId:o.vendorId},v);if(!e)return;U(t),O(null!==(d=null===(n=t[0])||void 0===n?void 0:n.id)&&void 0!==d?d:"")}S(null)}).catch(()=>{e&&S("Failed to load checkout data.")}).finally(()=>{e&&g(!1)}),()=>{e=!1}},[b,v]),(0,n.useEffect)(()=>{if(!v||!C.vendorId||"SHIPPING"!==H){_(null);return}let e=E.find(e=>e.id===D);if(!e){_(null);return}let t=!0;return(0,a.ni)({vendorId:C.vendorId,country:e.country},v).then(e=>{t&&_({available:e.available,flatRate:e.flatRate,currency:e.currency})}).catch(()=>{t&&_(null)}),()=>{t=!1}},[v,C.vendorId,H,E,D]),(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"surface p-5 md:p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-[#181f46]",children:"Checkout"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-[#5d6486]",children:"Shipping or pickup with single-vendor cart policy."})]}),P?(0,r.jsx)("div",{className:"surface border-[#ffd7dd] bg-[#fff5f6] p-4 text-sm text-[#b12f43]",children:P}):null,w?(0,r.jsx)("div",{className:"surface border-[#d1eeda] bg-[#f1fbf4] p-4 text-sm text-[#17724b]",children:w}):null,(0,r.jsxs)("div",{className:"grid gap-4 lg:grid-cols-[1fr_340px]",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("section",{className:"surface p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[#1a224d]",children:"Order items"}),y?(0,r.jsx)("p",{className:"mt-3 text-sm text-[#5d6486]",children:"Loading cart..."}):0===C.items.length?(0,r.jsxs)("p",{className:"mt-3 text-sm text-[#5d6486]",children:["Cart is empty."," ",(0,r.jsx)(l.default,{className:"font-semibold text-[#3550c0] underline",href:"/".concat(m,"/products"),children:"Browse products"})]}):(0,r.jsx)("div",{className:"mt-3 space-y-2",children:C.items.map(e=>{var t,s;return(0,r.jsxs)("div",{className:"rounded-xl border border-[#d8e1ff] bg-[#fbfcff] px-3 py-2 text-sm",children:[(0,r.jsx)("p",{className:"font-semibold text-[#1c2550]",children:null!==(s=null===(t=e.variant.product)||void 0===t?void 0:t.title)&&void 0!==s?s:"Product"}),(0,r.jsxs)("p",{className:"text-[#5f6890]",children:[e.qty," x ",u(e.unitPrice,Z)]})]},e.id)})})]}),(0,r.jsxs)("section",{className:"surface p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[#1a224d]",children:"Fulfillment"}),(0,r.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,r.jsx)("button",{className:"SHIPPING"===H?"btn-primary rounded-xl px-4 py-2 text-sm font-semibold":"rounded-xl border border-[#cbd6ff] bg-white px-4 py-2 text-sm font-semibold text-[#394784]",type:"button",onClick:()=>q("SHIPPING"),children:"Shipping"}),(0,r.jsx)("button",{className:"PICKUP"===H?"btn-primary rounded-xl px-4 py-2 text-sm font-semibold":"rounded-xl border border-[#cbd6ff] bg-white px-4 py-2 text-sm font-semibold text-[#394784]",type:"button",onClick:()=>q("PICKUP"),children:"Pickup"})]}),"SHIPPING"===H?(0,r.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,r.jsxs)("select",{className:"w-full rounded-xl border border-[#cfd9ff] bg-white px-3 py-2 text-sm",value:D,onChange:e=>F(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Select shipping address"}),E.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.line1,", ",e.city,", ",e.country]},e.id))]}),K?(0,r.jsxs)("p",{className:"text-sm text-[#42538f]",children:["Shipping fee:"," ",K.available?u(null!==(p=K.flatRate)&&void 0!==p?p:0,K.currency):"Unavailable"]}):null]}):(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsxs)("select",{className:"w-full rounded-xl border border-[#cfd9ff] bg-white px-3 py-2 text-sm",value:G,onChange:e=>O(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"Select pickup location"}),M.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.name," - ",e.city,", ",e.country]},e.id))]})})]}),(0,r.jsxs)("section",{className:"surface p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[#1a224d]",children:"Add shipping address"}),(0,r.jsxs)("form",{className:"mt-3 grid gap-2 md:grid-cols-2",onSubmit:Q,children:[(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"Name",value:R.name,onChange:e=>W(t=>({...t,name:e.target.value})),required:!0}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"Phone",value:R.phone,onChange:e=>W(t=>({...t,phone:e.target.value}))}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm md:col-span-2",placeholder:"Address line 1",value:R.line1,onChange:e=>W(t=>({...t,line1:e.target.value})),required:!0}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm md:col-span-2",placeholder:"Address line 2 (optional)",value:R.line2,onChange:e=>W(t=>({...t,line2:e.target.value}))}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"City",value:R.city,onChange:e=>W(t=>({...t,city:e.target.value})),required:!0}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"State",value:R.state,onChange:e=>W(t=>({...t,state:e.target.value}))}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"Postal",value:R.postal,onChange:e=>W(t=>({...t,postal:e.target.value})),required:!0}),(0,r.jsx)("input",{className:"rounded-xl border border-[#cfd9ff] px-3 py-2 text-sm",placeholder:"Country (US/MM)",value:R.country,onChange:e=>W(t=>({...t,country:e.target.value})),required:!0}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)("button",{className:"rounded-xl border border-[#c6d5ff] bg-white px-4 py-2 text-sm font-semibold text-[#3447a2]",type:"submit",disabled:N,children:"Save address"})})]})]})]}),(0,r.jsxs)("aside",{className:"surface h-fit p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-[#181f46]",children:"Payment"}),(0,r.jsxs)("dl",{className:"mt-3 space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-[#5d6486]",children:[(0,r.jsx)("dt",{children:"Subtotal"}),(0,r.jsx)("dd",{children:u(B,Z)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-[#5d6486]",children:[(0,r.jsx)("dt",{children:"Shipping"}),(0,r.jsx)("dd",{children:u(Y,Z)})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between border-t border-[#e0e7ff] pt-2 text-[#1f295d]",children:[(0,r.jsx)("dt",{className:"font-semibold",children:"Total"}),(0,r.jsx)("dd",{className:"font-semibold",children:u(B+Y,Z)})]})]}),"MMK"===Z?(0,r.jsxs)("div",{className:"mt-4 rounded-xl border border-[#d8e1ff] bg-[#f7faff] p-3",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wide text-[#6070a4]",children:"MMK Provider"}),(0,r.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"WAVE"===V?"btn-secondary rounded-lg px-3 py-1.5 text-xs font-semibold":"rounded-lg border border-[#c8d6ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3e4d91]",onClick:()=>L("WAVE"),type:"button",children:"Wave"}),(0,r.jsx)("button",{className:"KBZPAY"===V?"btn-secondary rounded-lg px-3 py-1.5 text-xs font-semibold":"rounded-lg border border-[#c8d6ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3e4d91]",onClick:()=>L("KBZPAY"),type:"button",children:"KBZPay"})]})]}):null,(0,r.jsx)("button",{className:"btn-primary mt-5 w-full rounded-xl px-4 py-2 text-sm font-semibold disabled:opacity-60",onClick:T,type:"button",disabled:y||N||0===C.items.length,children:N?"Processing...":"Place order & pay"})]})]})]})}},8440:function(e,t,s){"use strict";s.d(t,{_:function(){return a}});var r=s(800),l=s(6290),n=s(3178),d=s(2207);function a(){let e=(0,d.usePathname)(),[t,s]=(0,r.useState)(!1),[a,i]=(0,r.useState)(void 0),[c,o]=(0,r.useState)(null),u=()=>{var e;i(null!==(e=(0,l.zf)(n.Qs))&&void 0!==e?e:void 0),o((0,l.ZK)())};return(0,r.useEffect)(()=>{u(),s(!0)},[e]),(0,r.useEffect)(()=>{let e=()=>{u(),s(!0)};return window.addEventListener(n.UY,e),()=>{window.removeEventListener(n.UY,e)}},[]),{ready:t,accessToken:a,role:c}}},3808:function(e,t,s){"use strict";s.d(t,{V:function(){return r},t:function(){return l}});let r="eco:header-counts-refresh";function l(){window.dispatchEvent(new Event(r))}}},function(e){e.O(0,[46,320,716,550,744],function(){return e(e.s=7773)}),_N_E=e.O()}]);