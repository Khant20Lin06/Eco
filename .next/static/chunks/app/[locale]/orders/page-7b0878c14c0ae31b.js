(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{3736:function(e,t,s){Promise.resolve().then(s.bind(s,5369))},5369:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(5964),r=s(4141),n=s(800),l=s(3678),i=s(8440);function d(e,t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"MMK"===t?"MMK":"USD",maximumFractionDigits:"MMK"===t?0:2}).format(e/("USD"===t?100:1))}function c(e){let{params:{locale:t}}=e,{ready:s,accessToken:c}=(0,i._)(),[o,u]=(0,n.useState)(!0),[f,x]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),[h,b]=(0,n.useState)(null),[y,N]=(0,n.useState)([]),[w,v]=(0,n.useState)([]),[E,j]=(0,n.useState)(""),[g,P]=(0,n.useState)("");async function D(e){let[t,s]=await Promise.allSettled([(0,l.Vi)(e),(0,l.hh)(e)]);if("fulfilled"===t.status)N(t.value.items);else throw t.reason;"fulfilled"===s.status?v(s.value.items):v([])}(0,n.useEffect)(()=>{if(!s)return;if(!c){p("Please login to view your orders."),u(!1);return}let e=!0;return u(!0),D(c).then(()=>{e&&p(null)}).catch(()=>{e&&p("Failed to load orders.")}).finally(()=>{e&&u(!1)}),()=>{e=!1}},[s,c]);let S=(0,n.useMemo)(()=>{let e=new Set(["REQUESTED","APPROVED","RECEIVED"]);return new Set(w.filter(t=>e.has(t.status)).map(e=>e.order.id))},[w]);async function C(e){if(c){x(!0),p(null),b(null);try{await (0,l.E7)(e.id,"CANCELED",c),await D(c),b("Order ".concat(e.id," canceled."))}catch(e){p("Failed to cancel order.")}finally{x(!1)}}}async function M(e){if(c){x(!0),p(null),b(null);try{if("USD"===e.currency){let t=await (0,l.DF)(e.id,c);if(t.url){window.location.href=t.url;return}}else await (0,l.vp)(e.id,c);await D(c),b("Payment completed for order ".concat(e.id,"."))}catch(e){p("Failed to process payment.")}finally{x(!1)}}}async function k(e,t){if(c){x(!0),p(null),b(null);try{"WAVE"===t?await (0,l.vp)(e.id,c):await (0,l.HP)(e.id,c),await D(c),b("Payment completed for order ".concat(e.id,"."))}catch(e){p("Failed to process payment.")}finally{x(!1)}}}async function _(e){if(c&&g.trim()){x(!0),p(null),b(null);try{await (0,l.WG)({orderId:e,reason:g.trim()},c),await D(c),j(""),P(""),b("Return requested.")}catch(e){p("Failed to request return.")}finally{x(!1)}}}return(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"surface p-5 md:p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-[#181f46]",children:"Order History"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[#5d6486]",children:"Track payments, status transitions, and returns."})]}),m?(0,a.jsx)("div",{className:"surface border-[#ffd7dd] bg-[#fff5f6] p-4 text-sm text-[#b12f43]",children:m}):null,h?(0,a.jsx)("div",{className:"surface border-[#d1eeda] bg-[#f1fbf4] p-4 text-sm text-[#17724b]",children:h}):null,o?(0,a.jsx)("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"Loading orders..."}):0===y.length?(0,a.jsx)("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"No orders yet."}):(0,a.jsx)("div",{className:"space-y-3",children:y.map(e=>{var s,n;let l="PENDING_PAYMENT"===e.status||"PAID"===e.status,i="DELIVERED"===e.status||"PICKED_UP"===e.status,c=S.has(e.id),o="PENDING_PAYMENT"===e.status&&"MMK"===e.currency;return(0,a.jsxs)("article",{className:"surface p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-xs uppercase tracking-wide text-[#6371a8]",children:["Order #",e.id]}),(0,a.jsx)("h2",{className:"mt-1 text-lg font-semibold text-[#1a224e]",children:d(e.total,e.currency)}),(0,a.jsxs)("p",{className:"text-sm text-[#5d6486]",children:[e.fulfillment," â€¢ ",new Date(e.createdAt).toLocaleString()]})]}),(0,a.jsx)("span",{className:"PAID"===(n=e.status)||"DELIVERED"===n||"PICKED_UP"===n?"chip chip-success":n.includes("RETURN")||"REFUNDED"===n?"chip chip-warn":"CANCELED"===n?"chip chip-danger":"chip bg-[#eff4ff] text-[#4c5d9f]",children:e.status})]}),(0,a.jsx)("div",{className:"mt-3 space-y-2",children:(null!==(s=e.items)&&void 0!==s?s:[]).map(t=>{var s,r;return(0,a.jsxs)("div",{className:"rounded-xl border border-[#d8e1ff] bg-[#fbfcff] px-3 py-2 text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-[#1f2858]",children:null!==(r=null===(s=t.variant.product)||void 0===s?void 0:s.title)&&void 0!==r?r:"Product"}),(0,a.jsxs)("p",{className:"text-[#60709d]",children:[t.qty," x ",d(t.unitPrice,e.currency)]})]},t.id)})}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,a.jsx)(r.default,{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",href:"/".concat(t,"/chat?orderId=").concat(e.id),children:"Open chat"}),"PENDING_PAYMENT"===e.status?(0,a.jsx)(a.Fragment,{children:"USD"===e.currency?(0,a.jsx)("button",{className:"btn-primary rounded-lg px-3 py-1.5 text-xs font-semibold",onClick:()=>M(e),type:"button",disabled:f,children:"Pay with Stripe"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{className:"btn-secondary rounded-lg px-3 py-1.5 text-xs font-semibold",onClick:()=>k(e,"WAVE"),type:"button",disabled:f,children:"Pay with Wave"}),(0,a.jsx)("button",{className:"rounded-lg border border-[#bcd1ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3550c0]",onClick:()=>k(e,"KBZPAY"),type:"button",disabled:f,children:"Pay with KBZPay"})]})}):null,l?(0,a.jsx)("button",{className:"rounded-lg border border-[#ffc2cd] bg-white px-3 py-1.5 text-xs font-semibold text-[#c33f53]",onClick:()=>C(e),type:"button",disabled:f,children:"Cancel order"}):null]}),i?(0,a.jsx)("div",{className:"mt-4 rounded-xl border border-[#d8e1ff] bg-[#f8faff] p-3",children:c?(0,a.jsx)("p",{className:"text-sm text-[#59648f]",children:"Return already in progress."}):E===e.id?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("textarea",{className:"w-full rounded-xl border border-[#cfd9ff] bg-white px-3 py-2 text-sm",value:g,onChange:e=>P(e.target.value),placeholder:"Why are you returning this order?",rows:3}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn-primary rounded-lg px-3 py-1.5 text-xs font-semibold",type:"button",onClick:()=>_(e.id),disabled:f,children:"Submit return"}),(0,a.jsx)("button",{className:"rounded-lg border border-[#cfd9ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#44539a]",type:"button",onClick:()=>{j(""),P("")},children:"Cancel"})]})]}):(0,a.jsx)("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",type:"button",onClick:()=>j(e.id),children:"Request return"})}):null,o?(0,a.jsx)("p",{className:"mt-2 text-xs text-[#5d6486]",children:"MMK mock payment is enabled for MVP."}):null]},e.id)})})]})}},8440:function(e,t,s){"use strict";s.d(t,{_:function(){return i}});var a=s(800),r=s(6290),n=s(3178),l=s(2207);function i(){let e=(0,l.usePathname)(),[t,s]=(0,a.useState)(!1),[i,d]=(0,a.useState)(void 0),[c,o]=(0,a.useState)(null),u=()=>{var e;d(null!==(e=(0,r.zf)(n.Qs))&&void 0!==e?e:void 0),o((0,r.ZK)())};return(0,a.useEffect)(()=>{u(),s(!0)},[e]),(0,a.useEffect)(()=>{let e=()=>{u(),s(!0)};return window.addEventListener(n.UY,e),()=>{window.removeEventListener(n.UY,e)}},[]),{ready:t,accessToken:i,role:c}}}},function(e){e.O(0,[46,320,716,550,744],function(){return e(e.s=3736)}),_N_E=e.O()}]);