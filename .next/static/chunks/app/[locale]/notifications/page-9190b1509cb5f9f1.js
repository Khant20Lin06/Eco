(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[284],{3982:function(e,t,n){Promise.resolve().then(n.bind(n,754))},2207:function(e,t,n){"use strict";n.r(t);var a=n(5373),r={};for(var o in a)"default"!==o&&(r[o]=(function(e){return a[e]}).bind(0,o));n.d(t,r)},754:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var a=n(5964),r=n(800),o=n(2207),i=n(3678),c=n(8440),d=n(942);function s(e){let{params:{locale:t}}=e,n=(0,o.useRouter)(),{ready:s,accessToken:l,role:u}=(0,c._)(),{notifications:f,setNotifications:m,connected:p}=function(e){let[t,n]=(0,r.useState)([]),[a,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!e){o(!1);return}let t=(0,d.I)(e),a=()=>o(!0),r=()=>o(!1),i=e=>{n(t=>t.some(t=>t.id===e.notification.id)?t:[e.notification,...t])},c=e=>{n(t=>t.map(t=>t.id===e.notificationId?{...t,readAt:e.readAt}:t))},s=e=>{n(t=>t.map(t=>t.readAt?t:{...t,readAt:e.readAt}))};return t.on("connect",a),t.on("disconnect",r),t.on("notifications:new",i),t.on("notifications:read",c),t.on("notifications:read-all",s),()=>{t.off("connect",a),t.off("disconnect",r),t.off("notifications:new",i),t.off("notifications:read",c),t.off("notifications:read-all",s)}},[e]),{notifications:t,setNotifications:n,connected:a,markRead:(0,r.useCallback)(t=>{e&&(0,d.I)(e).emit("notifications:mark-read",{notificationId:t})},[e]),markAllRead:(0,r.useCallback)(()=>{e&&(0,d.I)(e).emit("notifications:mark-all-read",{})},[e]),disconnect:(0,r.useCallback)(()=>{(0,d.p)()},[])}}(l),[x,h]=(0,r.useState)(!0),[b,v]=(0,r.useState)(!1),[I,y]=(0,r.useState)(null),[N,w]=(0,r.useState)(null);async function j(e){if(l){v(!0);try{let t=await (0,i.R8)(e,l);m(n=>n.map(n=>{var a;return n.id===e?{...n,readAt:null!==(a=t.readAt)&&void 0!==a?a:new Date().toISOString()}:n}))}catch(e){y("Failed to mark notification as read.")}finally{v(!1)}}}async function k(e){if(!l)return;if(!e.readAt)try{let t=await (0,i.R8)(e.id,l);m(n=>n.map(n=>{var a;return n.id===e.id?{...n,readAt:null!==(a=t.readAt)&&void 0!==a?a:new Date().toISOString()}:n}))}catch(e){y("Failed to mark notification as read.")}let a=function(e,t,n){let a=n.payload&&"object"==typeof n.payload?n.payload:{};return"NEW_MESSAGE"===n.type?a.orderId?"/".concat(e,"/chat?orderId=").concat(encodeURIComponent(a.orderId)):"/".concat(e,"/chat"):"ORDER_STATUS_CHANGED"===n.type?"VENDOR"===t?a.orderId?"/".concat(e,"/vendor/orders?orderId=").concat(encodeURIComponent(a.orderId)):"/".concat(e,"/vendor/orders"):"ADMIN"===t?a.orderId?"/".concat(e,"/admin/orders?orderId=").concat(encodeURIComponent(a.orderId)):"/".concat(e,"/admin/orders"):a.orderId?"/".concat(e,"/orders?orderId=").concat(encodeURIComponent(a.orderId)):"/".concat(e,"/orders"):"RETURN_STATUS_CHANGED"===n.type?"VENDOR"===t?a.returnId?"/".concat(e,"/vendor/returns?returnId=").concat(encodeURIComponent(a.returnId)):"/".concat(e,"/vendor/returns"):"ADMIN"===t?a.returnId?"/".concat(e,"/admin/returns?returnId=").concat(encodeURIComponent(a.returnId)):"/".concat(e,"/admin/returns"):a.orderId?"/".concat(e,"/orders?orderId=").concat(encodeURIComponent(a.orderId)):"/".concat(e,"/orders"):"/".concat(e)}(t,u,e);n.push(a)}async function A(){if(l){v(!0);try{var e;let t=await (0,i.op)(l),n=null!==(e=t.readAt)&&void 0!==e?e:new Date().toISOString();m(e=>e.map(e=>e.readAt?e:{...e,readAt:n}))}catch(e){y("Failed to mark all notifications as read.")}finally{v(!1)}}}async function g(){if(l&&N&&!b){v(!0);try{var e;let t=await (0,i.wd)({limit:20,cursor:N},l);m(e=>{var n;return[...e,...null!==(n=t.items)&&void 0!==n?n:[]]}),w(null!==(e=t.nextCursor)&&void 0!==e?e:null),y(null)}catch(e){y("Failed to load more notifications.")}finally{v(!1)}}}(0,r.useEffect)(()=>{if(!s)return;if(!l){y("Please login to view notifications."),h(!1);return}let e=!0;return h(!0),(0,i.wd)({limit:20},l).then(t=>{var n,a;e&&(m(null!==(n=t.items)&&void 0!==n?n:[]),w(null!==(a=t.nextCursor)&&void 0!==a?a:null),y(null))}).catch(()=>{e&&y("Failed to load notifications.")}).finally(()=>{e&&h(!1)}),()=>{e=!1}},[s,l,m]);let R=f.filter(e=>!e.readAt).length;return(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"surface p-5 md:p-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-[#181f46]",children:"Notifications"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-[#5d6486]",children:"Realtime updates for orders, returns, and messages."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"chip ".concat(p?"chip-success":"chip-warn"),children:p?"Realtime connected":"Realtime offline"}),(0,a.jsxs)("span",{className:"rounded-full border border-[#d7e2ff] bg-white px-3 py-1 text-xs font-semibold text-[#2f428f]",children:["Unread: ",R]}),(0,a.jsx)("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",type:"button",onClick:A,disabled:b||0===R,children:"Mark all read"})]})]})}),I?(0,a.jsx)("div",{className:"surface border-[#ffd7dd] bg-[#fff5f6] p-4 text-sm text-[#b12f43]",children:I}):null,x?(0,a.jsx)("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"Loading notifications..."}):0===f.length?(0,a.jsx)("div",{className:"surface p-4 text-sm text-[#5d6486]",children:"No notifications yet."}):(0,a.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,a.jsx)("article",{className:"surface p-4 transition ".concat(e.readAt?"bg-white":"border-[#bfd0ff] bg-[#f6f9ff]"),role:"button",tabIndex:0,onClick:()=>k(e),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),k(e))},children:(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#6371a8]",children:e.type.replaceAll("_"," ")}),(0,a.jsx)("h2",{className:"text-base font-semibold text-[#1a224e]",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-[#5d6486]",children:e.body}),(0,a.jsx)("p",{className:"text-xs text-[#7a84ab]",children:new Date(e.createdAt).toLocaleString()})]}),e.readAt?(0,a.jsx)("span",{className:"chip chip-success",children:"Read"}):(0,a.jsx)("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-3 py-1.5 text-xs font-semibold text-[#3349ad]",type:"button",disabled:b,onClick:t=>{t.stopPropagation(),j(e.id)},children:"Mark read"})]})},e.id))}),N?(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("button",{className:"rounded-lg border border-[#c6d5ff] bg-white px-4 py-2 text-sm font-semibold text-[#3349ad]",type:"button",disabled:b,onClick:g,children:"Load more"})}):null]})}},8440:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var a=n(800),r=n(6290),o=n(3178),i=n(2207);function c(){let e=(0,i.usePathname)(),[t,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(void 0),[s,l]=(0,a.useState)(null),u=()=>{var e;d(null!==(e=(0,r.zf)(o.Qs))&&void 0!==e?e:void 0),l((0,r.ZK)())};return(0,a.useEffect)(()=>{u(),n(!0)},[e]),(0,a.useEffect)(()=>{let e=()=>{u(),n(!0)};return window.addEventListener(o.UY,e),()=>{window.removeEventListener(o.UY,e)}},[]),{ready:t,accessToken:c,role:s}}},942:function(e,t,n){"use strict";n.d(t,{I:function(){return c},p:function(){return d}});var a=n(3651);let r=n(5139).env.NEXT_PUBLIC_WS_URL||"http://localhost:3001/ws",o=null,i=null;function c(e){return o&&i===e?o:(o&&o.disconnect(),i=e,o=(0,a.io)(r,{auth:{token:e},transports:["websocket"],autoConnect:!0,reconnection:!0}))}function d(){o&&(o.disconnect(),o=null,i=null)}}},function(e){e.O(0,[438,320,716,550,744],function(){return e(e.s=3982)}),_N_E=e.O()}]);